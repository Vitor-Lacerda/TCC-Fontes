function [Y,Xf,Af] = myNeuralNetworkFunction(X,~,~)
%MYNEURALNETWORKFUNCTION neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 29-Jul-2016 11:41:56.
% 
% [Y] = myNeuralNetworkFunction(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 32xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 2xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [9.22410498152631;0.910944069308192;0.751688113135431;1.31191432396252;0.503248821505924;0;0.203847623901134;0.267737617135208;0.605172633456491;0.0267737617135208;0.00637023824691043;0.0127404764938209;0.28666072111097;0.0127404764938209;0.331252388839343;0.394954771308447;0.758058351382342;0.0127404764938209;0.0127404764938209;0.0191107147407313;0;0;0.00637023824691043;1.83462861511021;0.749665327978581;0.0382214294814626;0.00637023824691043;0.776439089692102;0.0803212851405622;0.273920244617149;0.0891833354567461;0.0573321442221939];
  x1_step1_gain = [0.0302757955641273;0.171469142545057;0.209446297531688;0.189593908629442;0.143557384545039;3.55714285714286;0.952972755967454;0.244142449667923;0.50001070257045;2.988;2.89961153573204;2.81630209233962;0.836569655246215;2.71398093845036;0.303636363636364;0.250967226219025;0.165014853777782;0.773899643355886;2.36961237991699;1.76653314432314;5.33571428571429;9.3375;3.98143667643374;0.135947549203055;0.316525423728814;1.53790948078008;2.28007559804705;0.136854541240387;0.553333333333333;0.260980881130507;0.479864320053427;0.381397513618893];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [1.4921548697998999;-1.2808403394508521;-1.2689870738983757;-0.84560474914563155;-0.60841014548081773;-0.4103514387920531;0.23629175625881244;0.36888288227714439;-0.23400334336485465;0.39354754417400178;-0.64179722732055688;-0.83417864239573936;-1.0981641799358524;-1.2060096387146293;1.5133196045548434];
  IW1_1 = [-0.49445565550819004 0.24356398955204633 0.21315448519589456 0.061301360376768407 0.37335844939881419 0.085659102884853011 -0.47811326292816841 -0.47783784205034069 0.12340125440556245 -0.18142431404222725 -0.15742123751248036 -0.16236023833785304 -0.14740953006413135 -0.30054585685386298 -0.25774543439774267 -0.021643252561851057 0.44724880709363529 0.4576556751022815 -0.28078034855810763 0.33881316951300255 -0.12735784743319273 -0.14798879031556214 0.23280078918197059 -0.036739759647838065 -0.23062819840738327 -0.11009217441024831 0.15262457809758034 -0.077888000496982454 -0.32019382674824831 -0.20695123441479168 0.2792899849283344 -0.32071316515470777;0.35205023793556933 -0.20022816516668998 0.13746109014429797 -0.37911683912778943 0.073905658179196532 -0.044018961517342303 -0.2818730748769801 -0.13780002388812895 -0.14452891455954545 0.40007643352681083 0.33350914989127123 0.10834685495364652 0.32637309698724221 -0.34595873572762442 0.095496799678958841 0.059801812839296128 0.41016473548572002 -0.18351847352969933 0.39028615820315432 0.3191273179649976 0.34589139453633899 -0.32274930906292937 0.16436365874007944 0.50155066026913941 0.1363956952544188 -0.19351298595768349 -0.10654107851452103 0.021555551664308486 0.18109219981867777 0.27272809621604421 -0.32388894186081502 -0.39966593731574107;0.58211083422986554 0.68770883516526582 -0.1966066876326398 -0.28727610755960553 -0.089262424604348467 -0.44379212533417184 0.68760895133798505 -0.39213042112636398 0.26223858935650013 -0.07015734310735687 -0.21797021971763669 0.21847726702745887 0.32810130773179014 -0.25071299382317158 0.41555659605930217 -0.55662323964881766 0.26428011853048616 0.23505106945976836 -0.41751569834935798 -0.0038262032428993745 0.2326359349899122 -0.050483056686239605 0.10285421134130492 -0.091840309807029535 -0.27782725592208696 -0.48918514237850863 0.043699872941974097 -0.19294551521905864 0.19917725808979583 -0.14532061234356999 -0.36596870007551752 -0.1838614029196049;0.13119852211554128 -0.40641155920641608 -0.32948819904386339 -0.20798756252768655 0.36510748368996948 -0.14549507342921184 -0.29812059797942075 0.27492951568621771 -0.085703427888661407 -0.34595706344631816 -0.41348258584402525 -0.36245916812566031 -0.13269632119786501 -0.057629953198297522 -0.24502130165939562 -0.016868079964611968 -0.34744521833567477 -0.27172191566860676 -0.021185521599158191 -0.29413352381559749 -0.38624032311642159 -0.15007171139841288 0.16558983288354978 0.28871865117513978 0.27152836636630129 -0.2697754884372397 0.20024037077971585 0.32734508823579078 -0.13766464755652924 -0.39907039588387672 -0.35211905101813484 -0.031929761576522768;0.2015028400092774 -0.093223365211786396 -0.023327622923017072 0.30047400961485204 -0.1888161623110666 -0.30620316014307625 0.28969195697992894 -0.038646125189113756 -0.37554960193033299 0.23808777817911483 -0.32136998140200534 0.39545295602501607 0.38537923202630031 -0.1769510054561233 -0.36679742885644845 0.42661371979080392 -0.23490551057573059 -0.44757821606987075 -0.31438939213145606 0.16706137941445309 -0.10122889477281355 0.39647940793166936 0.13324751424435807 0.10445551469766719 0.41687266038676285 -0.041707407590708803 0.45477241488207026 0.028271927042800432 0.25083828755159698 -0.2889386699688602 0.083464272074783324 -0.0062821222314769568;0.22363903255713552 -0.12055527853768609 0.45306865538681579 -0.24912650064426387 0.25209825944227421 0.28903517877572116 0.046637093620205947 0.40373145158280738 -0.25357844525492362 -0.10890624075366705 0.14268118611763994 0.27716194791711024 0.37217360753075496 0.42234800277764051 -0.20475541844621012 0.05304257051404538 -0.16736491404167053 0.23894162809155781 0.47149447414799439 0.026730097091083944 0.027667672342867395 0.42007443640108916 -0.31787334561630104 -0.13906159033304163 0.21956628502751452 -0.39268181890512266 0.02949736782691624 0.43462596130579034 0.17133290789099143 0.21544052281319373 0.19037477917403919 0.16888406938353331;-0.17615732563221612 0.22554267727899222 -0.16087657421665127 0.36095304101890535 0.31575928087755689 -0.1901097275796661 0.49402405790958487 -0.216205374472487 -0.43655674827493485 -0.2919771483702478 0.16852888071058256 0.014581745953772811 -0.013796808259489281 -0.095954335501926002 -0.24074289766702636 0.096845429412008924 0.18885589901463903 -0.032879494430105856 0.2141263475080227 0.5422681845956282 -0.098253710454342183 -0.44552382932118811 -0.43132361918707018 -0.3547646810890237 -0.14270368245877568 0.15712079087683753 -0.10695855569116691 0.21689040040612537 -0.49132554166880527 0.018345021690618749 0.093415518879053847 0.34082392752413998;-0.18537624145773618 0.1490354599486714 0.042888794508860614 -0.30309986844712883 -0.055619040975638211 -0.04623538937520745 -0.52006035195550437 -0.058880823878587021 -0.33145685129514851 -0.2355674511465424 -0.13574213385838252 -0.013147720883339806 0.059286605079201062 -0.51659330212051269 -0.23983167743345993 -0.11379294056714886 -0.45051777826699585 -0.23397420063557411 -0.14894781331137708 0.36159984251173838 0.15768585502411825 0.18332141839993565 0.35533184059867479 -0.27206635752576069 0.13703714273248677 0.14612387617877109 -0.33307975550455088 0.68078350560924639 0.15677578097238423 -0.3112731718503452 0.017293342191163685 -0.0032231268897180768;-0.37458247350793161 -0.36169805407727484 -0.29732491972700431 0.47367320428686682 0.09877649785756594 -0.35376245770012277 -0.091851836667351985 -0.34252679390037394 -0.29917649233982929 -0.43258602125211559 -0.073207803002198785 -0.046027540965662479 0.066386228446459777 0.44274298524118283 -0.01003326231677612 0.023179065366011463 0.25627350333268878 0.44163921661334121 -0.02879936562197067 0.34873977191525279 0.14656662596528489 -0.23766770119101044 -0.36881630875901283 -0.013163092900576503 -0.40269155001145684 0.2341094189624246 0.16080911126010425 -0.24955710970835787 -0.10211540213754278 -0.141150851364411 0.18013840166978837 0.20553595706713237;0.2966621629125894 0.042395367535057064 0.24797485667099989 -0.15057510343187369 -0.44577844141513756 0.061973626402922387 -0.37344959461050248 -0.42504274974704104 -0.11417764150613532 -0.36614986353881968 0.087024300377004524 -0.24470662253498526 -0.26624939680926046 0.44209557834452196 -0.3470075266036729 0.029206299533214547 -0.39143320195509301 0.1097994403000352 -0.44447767277866918 -0.15898175712755269 -0.25696034243052118 -0.12489578124991901 -0.44038875202308148 -0.33355509195505911 0.35946301463408264 0.085838684237710683 0.1644095411262963 0.1053915919188456 0.33132308778577363 0.047680973214260847 0.045257008414351645 -0.18454213899575414;-0.49555000313107073 -0.086140421241951579 -0.24484798523270893 -0.29358905445032735 -0.41429621061096117 -0.2349775579712545 0.43115839924206367 0.41747675950413954 -0.47079379950604255 0.42456858880454401 -0.24453595323764765 0.018321700571608167 -0.23273891104548372 -0.077371766794741698 -0.26451522973412539 0.20789430507928322 0.1507885219504575 0.09512245636324021 0.15946094093049057 -0.045948750457071322 -0.073458963568073132 0.033755902266114697 0.032565199895169469 0.082976023144610236 0.39159756335264784 0.15719008937057383 -0.041849886973668662 -0.1688081781825603 -0.47945352697936922 -0.27986751657427955 0.18912546297876359 0.37038083745934391;-0.22416401996326193 0.12848337867903648 0.005483107254346347 -0.233185536881196 0.022673531920597997 0.12857117413915767 -0.44196744045341696 0.071511969707720502 0.35954553085757673 0.40727220732367531 0.20392096241914359 0.0047986344600996367 -0.030807471020750855 -0.35089762361869942 0.26660201949123619 -0.084865950142052435 -0.0052046972117616034 0.31617843817532926 -0.41681410534103114 0.29562416005342734 -0.43981692470608014 0.39599142564135292 0.33689375611137679 -0.26745863222127098 0.2809064977967457 -0.41302591593619759 -0.37613584391928895 0.14904777743715719 -0.04118864114644484 0.2108652674112042 0.12837474127547349 0.29951790803010436;-0.35639192373292122 0.23865881635247743 0.17433012293421066 0.10212529945157042 0.19750412283560953 0.15047491724534609 0.32167842289460791 -0.0082540615385554815 0.44339171936021954 0.045129410124864447 -0.26058041511844637 0.27577358613460556 -0.16764474199844082 -0.24139963022921615 -0.38868111326109928 -0.20733936129114383 0.22964901761760992 0.26710016064873249 -0.41202754834990929 -0.44441244990701451 0.41997727881727503 -0.099299747385852302 0.17607153393044805 -0.084009837473789192 -0.24119604975499528 -0.44021384534466818 -0.27135128562051786 0.11081942867058144 -0.10510434115919685 -0.30805956769484738 0.34839957649586845 -0.28322592924215401;-0.51037106050056347 0.21457821982823824 0.42678212042484426 -0.050481335337769238 0.40925218513241551 0.14387260360131357 0.19048705484437434 -0.15873286369832595 -0.10376678466204617 -0.4044225624845445 0.01577886199539465 0.20858536634580854 0.1586176370462033 -0.12966683886558167 0.3724193921067121 0.66160696571207978 0.31191800376327228 -0.0029593010873575623 -0.054874867087834948 -0.31874023830212744 -0.35546029011423713 0.40703243389834637 -0.4362966864899388 -0.042373837435183082 0.13008482662544002 -0.20552758495251286 -0.31896106010036418 -0.34500722234164077 -0.07336866747690543 0.52843552752285217 -0.22163061317856997 0.093786469612034531;0.31567911003668087 -0.23287087992210315 0.42002272204797919 -0.13545461511015247 -0.34391514991732597 -0.058554100081096919 0.34257689832801297 0.30071762003127811 -0.011129745858374887 -0.26022643142808877 -0.24678850085362145 0.12471803305489097 -0.26730846152514953 0.082422752761023121 0.22368921760137045 -0.44102996779604348 0.35594143557776309 -0.3034449154599933 -0.38299433685298556 -0.32737368796735206 -0.36339977048489175 -0.20481240935501857 -0.12622189041216597 -0.20080725656185636 -0.43460107030051548 0.0089416414914076543 -0.22228874747520697 -0.22002930713024174 0.26243378939366152 -0.20623395667816438 0.17573873591514405 0.060132434652450502];
  
  % Layer 2
  b2 = [-0.59050548783955581;-0.17104565089204177];
  LW2_1 = [0.27076938774518711 -0.7194101051353986 -1.1529897967526133 0.180682663262202 0.42999298971184186 0.19634080309575641 0.56011475192638349 0.77072534866411935 -0.63764754336179119 -0.71061264459829609 0.016346761314501541 0.37135746961698884 0.38995380217270625 0.80921599506626063 -0.49682031237855329;0.55059135121964675 -0.11488369095122308 1.2710778195508365 0.069347536580620706 -0.061926846578099416 0.18605402548977723 -0.073030899212556483 -0.34596283562314761 -0.93136098109136412 -0.35304462173624085 -0.38796858350516833 0.41144457130897555 1.019714109493423 -0.4796775882046832 0.16710139220285353];
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = softmax_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Output 1
    Y{1,ts} = a2;
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(2,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Competitive Soft Transfer Function
function a = softmax_apply(n)
  nmax = max(n,[],1);
  n = bsxfun(@minus,n,nmax);
  numer = exp(n);
  denom = sum(numer,1); 
  denom(denom == 0) = 1;
  a = bsxfun(@rdivide,numer,denom);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end
