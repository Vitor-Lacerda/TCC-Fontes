function [Y,Xf,Af] = RedeLBP(X,~,~)
%MYNEURALNETWORKFUNCTION neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 28-Jul-2016 17:21:35.
% 
% [Y] = myNeuralNetworkFunction(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 32xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 2xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [360;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0];
  x1_step1_gain = [0.00059506099375186;0.00324675324675325;0.00348432055749129;0.00284900284900285;0.00269541778975741;0.285714285714286;0.0110497237569061;0.00301204819277108;0.0105820105820106;0.1;0.181818181818182;0.125;0.0144927536231884;0.142857142857143;0.00277392510402219;0.00309597523219814;0.00243013365735115;0.0344827586206897;0.133333333333333;0.08;0.222222222222222;0.5;0.222222222222222;0.0019588638589618;0.00392927308447937;0.0606060606060606;0.153846153846154;0.00193236714975845;0.024390243902439;0.00420168067226891;0.015625;0.0238095238095238];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [1.5910001281197725;-0.97032133693271283;-0.83279348419598154;-0.43421481490655495;-0.22203978600038468;0.1737697851222369;-0.5101471749223081;0.96904254552545488;-1.2838124340741535;1.5101624879736417];
  IW1_1 = [-0.6022327453859414 -0.50717110522343134 -0.062596559117308812 0.11347936663388004 -0.2521405878355471 -0.2261678277315412 0.24230418987116023 -0.3404729065807936 0.17771416631465894 -0.40055965957511386 0.34373560960247174 0.31113026112990055 0.022408418823297721 -0.38168247262982619 -0.071173598352334042 0.034771300219575627 -0.14866964837043406 0.30137444295152538 -0.11486465127466369 -0.20880504788706547 0.29353600584786876 -0.23914623452964842 -0.25984856241534549 -0.04609556138158033 0.34108246685095422 0.091884267439897777 0.17352725168461047 -0.27356105260791524 0.13828013126821539 0.13658349186125029 0.011091917165515866 -0.021962015463332395;0.17048960059580959 -0.46902700607153636 0.18354956340981293 -0.0069996857494415282 -0.12477505244667186 0.19591904004494098 -0.069521490914476916 0.058652819327421855 -0.37182502467062084 -0.37061160971704038 -0.59797533626261545 -0.452045708496571 -0.31395979032795468 0.29837813919412209 -0.30802486130108914 0.4417754219552148 0.20093082031461004 -0.057726531535851305 0.13787376314979227 -0.089155641293894569 -0.26680572636453548 0.033256444372644106 0.13851711286702656 -0.11635322815813109 0.38699892494925514 -0.086568504210813954 -0.10631602995990198 0.25201660487505795 -0.57175811994118275 0.51374257582091876 0.3499311180709575 -0.4748409510126676;0.40776324515191142 -0.35522188988033404 0.23926999000115362 -0.29648712240161179 0.14381405361565477 -0.22702981267067068 0.050272260160789749 0.20294857718026837 0.057465211591526393 0.36122410202888494 0.25204795122347345 -0.20923271685841446 0.033574190795611587 0.3838398684939594 -0.093275118221668271 -0.45979557173697094 -0.27309574319793045 -0.079686445832323788 0.026394683807237345 -0.24599029291054905 -0.26833883820493121 0.17048370224930107 -0.39022131642660673 -0.22920181020276184 0.23241583270103372 0.22789525331137789 -0.018871998595981068 -0.4317032675760199 -0.38133535995555351 0.082642986276345531 0.22701536527377938 0.37984749234662663;0.0010534673741865314 -0.70230433961305572 -0.30749028401217943 -0.37099111285639036 0.3388424860018559 0.22918600618831117 0.25901178351470006 0.55381528051743123 -0.48082743930741623 -0.35529351493064887 0.14231759723934281 -0.32652706248806967 -0.22422494818240757 -0.093135270013806809 -0.35482313756426492 -0.17584768091202646 0.11650912875897117 0.041786691703378377 -0.21017783077112948 0.33233510317432202 0.25440428457873998 -0.27552552888908993 0.11185201004982415 -0.011393771625454123 -0.25954948774293174 0.2044584467505986 0.28690201498465429 0.092014609181658033 -0.066676744279645192 0.39572400058958207 -0.27745616133068607 -0.15187651154808129;0.0087774446987848118 -0.066043833610058042 0.084204631247406236 0.0083395189709323699 0.60809631031087619 -0.14258343592086778 -0.31474546062893216 -0.028591100148370095 -0.20187267330558598 0.25276109401752422 0.22816481576625824 -0.35116431186883795 -0.60369141991005304 -0.01089370369582008 -0.27354865462192507 0.097633974453808753 -0.19310720530155717 0.051250162839065201 0.38822540872959893 -0.15903032785565066 0.45342259306419835 -0.2806590875800129 0.040753383674711006 0.14799296888238858 -0.0071740752584727487 0.47967195198673074 0.095190713424305989 -0.051029227461759259 -0.31205668062882713 0.30729897468424555 0.167119456427513 -0.085179179915267605;0.20981694064722128 0.093847332163029429 -0.079773767083248195 0.48196691108770412 0.04685635523453395 -0.34759136261657969 0.27359562290864503 0.13523988662128025 -0.29589957594683858 0.019985497253139313 -0.42439072575378101 0.38357289592005739 -0.28671030202987985 -0.19798955472774626 0.48196220073212481 0.22909827993771875 -0.14370402803498875 0.013977870288652484 0.35804086027902221 -0.2858412930729976 -0.070693810199287374 -0.20294706849462266 -0.062538757912958279 0.2208258173168951 -0.13873170900082579 0.43823785236810181 0.14578419121071909 0.55295030352712449 0.30723623278679263 -0.021616873106534436 0.060885136605728411 -0.085088405614618751;-0.077424882230495637 -0.17994737778699282 0.13636563708964516 -0.16306541497466467 -0.38849993246125958 -0.26040809639269635 0.27929633010105637 -0.050995806187252683 0.19048040221771539 0.529194516833841 -0.082526149036811644 0.091040289025673002 -0.37034317155687668 0.41630434209876849 0.47084414639926692 0.20721710207851984 0.12060357119023454 -0.0094562352986014894 0.048916784272755934 -0.34552470624321735 -0.39613312533913841 -0.19297503341707997 0.097591995456394909 -0.094141062965083649 0.18130737384936399 -0.17305762083849416 0.38459463592244358 0.2156046056049763 0.3238120900800377 0.30185780722734945 -0.11736902783285212 -0.33361864589217072;0.022271119649332028 0.35863023528711602 0.18638915864984273 0.067970971191706739 -0.3852747891670355 0.02517248544069824 -0.17170050192324027 -0.47891913983262502 0.11179378550179479 -0.51355763280227029 -0.34179611168465501 0.03026393057218274 -0.38775289964202142 -0.2212983964257495 0.028073179297350953 0.15170724068654018 0.21876602896367142 0.2752174056125648 0.040760022066935242 -0.29793164631378338 -0.36148811410274168 -0.15467688005754662 -0.36190001845030356 -0.21963427724251944 -0.40592784708114876 0.18456038840145189 0.26532118228992274 -0.01034748506118895 0.17340950005342576 -0.43311052376447784 0.14093937557919659 0.025658229291981544;0.10853390633916282 0.17982615169362193 0.20106921353886947 -0.12564286235160355 -0.17576552963604897 0.1576637080868501 0.10287800264980335 -0.62575439542753819 0.7579728557214136 0.061766624962055844 0.33322211388833151 -0.22818328182238082 -0.041482520944121477 -0.17649448979621873 -0.59263650432079684 -0.6988348799372508 -0.48796133004542885 0.23835937671858121 0.35211838036780796 -0.042920220191541313 0.017556726433406084 -0.042615345357729532 0.16243468929508623 0.55948170737314262 -0.045658350813267592 -0.35821290129747124 0.20837841735421755 -0.23101647364376313 -0.10849511071376963 -0.87444898389848413 -0.17194022299222439 -0.46093243591736754;0.17214382320563432 -0.058502144114577173 -0.19630849178180204 0.21550663790211186 0.29084020526177801 -0.13417883475763365 -0.3677868831011642 -0.29076881157873952 -0.045487680155120003 -0.344321354055871 -0.062198159737949642 0.3027227476628091 -0.071051392944254541 0.23899637034904447 -0.22849672974134411 0.04135191466265617 0.36821285050527985 0.12156146203009638 -0.25825326094831574 -0.16631887412990476 0.077121624183185342 -0.36198213224902653 0.3961874188748799 -0.40266506962896081 -0.34156804117800149 -0.40832843941413766 -0.27405593008305729 -0.38254951829287681 0.13413769234827713 -0.27968023382414064 -0.18028102156609616 0.39031017431731008];
  
  % Layer 2
  b2 = [0.030027908946736123;0.85610467737620399];
  LW2_1 = [0.70295543114409442 0.7825319313352489 0.072497080740510311 1.0563356354345141 0.57792220009257633 0.57172235527012005 0.37256521409802862 0.12744441547592722 -1.1312429345646935 -0.77101633896247068;-0.75693735610938184 -0.76857688750414388 -0.13108404829320519 -0.33537345824732107 -0.0089073697287332769 0.16315285970058371 0.10189875634830151 -0.43812367987007794 1.38543252352776 -0.82153988726360916];
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = softmax_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Output 1
    Y{1,ts} = a2;
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(2,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Competitive Soft Transfer Function
function a = softmax_apply(n)
  nmax = max(n,[],1);
  n = bsxfun(@minus,n,nmax);
  numer = exp(n);
  denom = sum(numer,1); 
  denom(denom == 0) = 1;
  a = bsxfun(@rdivide,numer,denom);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end
